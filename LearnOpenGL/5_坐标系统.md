#### Key Term

**模型坐标变换**
- ![[OpenGL_模型顶点变换过程.png]]
	- 局部坐标是对象相对于局部原点的坐标，也是物体起始的坐标
	- 世界空间坐标相对于世界的全局原点
	- 变换到观察空间坐标使得每个坐标都是从相机/观察者的角度进行观察
	- 到达观察空间后，坐标会被投影到裁剪坐标。裁剪坐标会被处理至\[-1.0,1.0]的范围内，并判断哪些顶点将会出现在屏幕上
	- 最后使用*视口变换(Viewport Transform)* 将裁剪坐标变换为屏幕坐标。视口变换将位于-1.0到1.0范围的坐标变换到由glViewport函数所定义的坐标范围内。最后变换出来的坐标将会送到光栅器，将其转化为片段

**局部空间**
- 模型的所有顶点都是在局部空间下的

**世界空间**
- 模型的顶点坐标从*局部空间* 由*模型矩阵(Model Matrix)* 变换到*世界空间*

**观察空间**
- 观察空间就是从摄像机的视角所观察到的空间
- *观察矩阵(View Matrix)* 将世界空间坐标转化为用户视野前方的坐标

**裁剪空间**
- 由*投影矩阵(Projection Matrix)* 将模型坐标从观察空间变换到裁剪空间
- 投影矩阵会指定一个坐标的范围，如每个纬度上的-1000到1000。超过这个范围的坐标将会被裁剪掉，其余坐标会被变换到\[-1.0, 1.0]范围内的标准化设备坐标系
- 当所有的有效顶点都被变换到裁剪空间后，*透视除法(Perspective Division)* 将会执行
	- 在这个过程中我们将位置向量 的x, y , z分量分别除以向量的齐次w分量
	- 透视除法是将4D裁剪空间坐标变换为3D标准化设备坐标的过程
	- 这一步会在每一个顶点着色器运行的最后被自动执行
- 在裁剪空间中执行完所有操作后，坐标会被映射到屏幕空间中(使用glViewPort)中的设定，并被转换为片段

**正交投影 VS 透视投影**
- 正交投影
	- 正交投影定义了一个方体盒子的裁剪空间，在盒子之外的顶点都会被裁减掉，盒子内则不会
	- 创建正交投影矩阵需要指定盒体的宽，高，和长度(深度)
	- ![[OpenGL_正交投影.png]]
	- 正交投影的盒体定义了可见的坐标，由宽、高、近平面(Near Plane)、远平面(Far Plane)指定。在近平面之前和远平面之后的坐标也会被裁剪掉
	- 正交的盒体直接将盒体内部的所有坐标映射为标准化设备坐标，因为每个向量的w分量都没有进行改变(如果w分量等于1.0，透视除法则不会改变这个坐标)
	- 正交投影矩阵会直接将坐标映射到2D平面中，也就是屏幕

- 透视投影
	- 透视投影矩阵会修改每个顶点坐标的w值，使得距离观察者越远的顶点坐标w分量越大
	- ![[OpenGL_透视投影计算.png]]
	- 顶点坐标的每个分量都会除以他自己的w分量，因此距离观察者越远顶点坐标就会越小，从而形成透视的感觉
	- ![[OpenGL_透视投影盒体.png]]
	- 

*模型通过MVP矩阵从模型空间变化到裁剪空间：
![[OpenGL_模型顶点变换公式.png]]
并在顶点着色器中完成输出(顶点着色器的输出要求所有的顶点都在裁剪空间内)。然后OpenGL会对裁剪坐标执行透视除法从而使他们变换到标准化设备坐标。
OpenGL会使用glViewPort内部的参数来酱标准化设备坐标映射到屏幕坐标，每个坐标都关联了一个屏幕上的点。这个过程被称为视口变换。*

#### Key Code

- **创建正交投影矩阵**: glm::ortho(0.0f, 800.f, 0.0f, 600.0f, 0.1f, 100.0f);
	- 盒体左坐标
	- 盒体右坐标
	- 盒体底部坐标
	- 盒体顶部坐标
	- 近平面距离(距离摄像机)
	- 远平面距离(距离摄像机)
	- 这个投影矩阵会将处于这些x, y, z值范围内的坐标变换为标准化设备坐标
- **闯将透视投影矩阵**: glm::mat4 proj = glm::perspective(glm::radians(45.0f), (float)width/(float)height, 0.1f, 100.0f);
	- 视野范围/FOV(Field of View)-通常设置为45
	- 宽高比-视口的宽除以高
	- 近平面距离(距离摄像机)
	- 远平面距离(距离摄像机)
*如果透视矩阵的近平面值设置的太大的话，当摄像机靠近一个物体时，视线会直接穿过这个物体*


